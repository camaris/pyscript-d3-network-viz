<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="script-src 'self' 'unsafe-eval' 'unsafe-inline' 'wasm-unsafe-eval' https://pyscript.net https://d3js.org https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://pyscript.net https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; worker-src 'self' blob: https://pyscript.net https://cdn.jsdelivr.net; connect-src *;">
    <title>PyScript D3 Network Visualizer</title>

    <!-- PyScript (Pinned Version for Stability) -->
    <link rel="stylesheet" href="https://pyscript.net/releases/2026.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2026.1.1/core.js"></script>

    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="./style.css?v=10">

    <!-- Custom Graph Logic (D3) -->
    <script src="./graph.js?v=7"></script>
</head>

<body>

    <!-- UI Layer -->
    <div id="ui-layer">
        <!-- Toggle Button -->
        <button id="panel-toggle" class="btn-icon" aria-label="Toggle Settings">
            <i class="fa-solid fa-gear"></i>
            <span>Settings & Filters</span>
        </button>

        <div id="settings-panel" class="glass-panel hidden">
            <div class="panel-header">
                <h2>PyScript + D3.js</h2>
                <button id="close-panel" class="btn-close"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <span class="subtitle">Interactive Knowledge Graph</span>

            <div class="control-group" style="margin-top: 1rem;">
                <label for="exampleSelect">Select Dataset</label>
                <select id="exampleSelect">
                    <option value="school" selected>School Data</option>
                    <option value="karate">Karate Club</option>
                    <option value="small_world">Small World</option>
                    <option value="scale_free">Scale Free</option>
                    <option value="tree">Balanced Tree</option>
                    <option value="random">Random Graph</option>
                </select>
            </div>

            <!-- Dynamic Filters -->
            <div id="filter-container"
                style="margin-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 0.5rem;">
                <label style="margin-bottom: 0.5rem; display: block;">Filters</label>
                <div id="filter-controls"
                    style="display: flex; flex-direction: column; gap: 0.5rem; max-height: 150px; overflow-y: auto;">
                    <!-- Checkboxes will be injected here by JS -->
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label for="gravityRange">Gravity</label>
                    <input type="range" id="gravityRange" min="-1000" max="-50" value="-400">
                </div>
                <div class="control-group">
                    <label for="linkDistRange">Link Distance</label>
                    <input type="range" id="linkDistRange" min="50" max="300" value="150">
                </div>
                <button id="resetBtn" class="btn">Reset View</button>
            </div>
        </div>
    </div>

    <!-- Container for D3 Graph -->
    <div id="graph"></div>

    <!-- Loading Indicator -->
    <div id="loading-indicator">Initializing Python Environment...</div>

    <!-- Python Logic -->
    <!-- Using modern script type="py" for PyScript 2026.1.1+ -->
    <script type="py" src="./main.py?v=7" config="./pyscript.json?v=7"></script>

    <!-- UI Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const panel = document.getElementById('settings-panel');
            const openBtn = document.getElementById('panel-toggle');
            const closeBtn = document.getElementById('close-panel');

            if (openBtn && panel) {
                openBtn.addEventListener('click', () => {
                    panel.classList.remove('hidden');
                });
            }

            if (closeBtn && panel) {
                closeBtn.addEventListener('click', () => {
                    panel.classList.add('hidden');
                });
            }
        });
    </script>
</body>

</html>